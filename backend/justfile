dev:
    just run

run:
    zig build run

test:
    zig build test

cli *args:
    #!/usr/bin/env bash
    # nb: langnet-cli is out of project
    # we are relying on the devenv shell being set up
    cd .././../langnet-cli && devenv --quiet shell just -- cli {{args}}

cli-example:
    just cli query lat sedat --output json | nu -c 'cat | from json | to yaml'

run-server:
    zig build run

run-server-bg:
    #!/usr/bin/env bash
    zig build run &
    echo $! > /tmp/backend-server.pid
    echo "Server started on http://127.0.0.1:43280 (PID: $(cat /tmp/backend-server.pid))"

stop-server:
    #!/usr/bin/env bash
    if [ -f /tmp/backend-server.pid ]; then
        kill $(cat /tmp/backend-server.pid) 2>/dev/null || true
        rm /tmp/backend-server.pid
        echo "Server stopped"
    else
        echo "No server PID file found"
    fi

test-server:
    #!/usr/bin/env bash
    # Start server in background
    zig build run &
    SERVER_PID=$!
    sleep 1
    # Test endpoints
    echo "Testing health endpoint..."
    curl -s http://127.0.0.1:43280/health
    echo ""
    echo "Testing API endpoint..."
    curl -s http://127.0.0.1:43280/api
    echo ""
    echo "Testing DB endpoint (zuckdb demo)..."
    curl -s http://127.0.0.1:43280/db
    echo ""
    echo "Testing root endpoint..."
    curl -s http://127.0.0.1:43280/ | head -20
    # Stop server
    kill $SERVER_PID 2>/dev/null || true

test-db:
    #!/usr/bin/env bash
    # Start server in background
    zig build run &
    SERVER_PID=$!
    sleep 1
    # Test DB endpoint
    echo "Testing zuckdb endpoint..."
    echo ""
    curl -s http://127.0.0.1:43280/db
    echo ""
    # Stop server
    kill $SERVER_PID 2>/dev/null || true

readme-zzz:
    curl https://raw.githubusercontent.com/tardy-org/zzz/refs/heads/main/docs/getting_started.md
    
install-zzz:
    zig fetch --save "git+https://github.com/tardy-org/zzz#v0.3.0-rc1"
    
install-mustache:
    zig fetch --save "git+https://github.com/batiati/mustache-zig#master"
